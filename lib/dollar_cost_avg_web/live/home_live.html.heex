<.flash_group flash={@flash} />
<div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg">
  <h1 class="text-3xl font-bold mb-6 text-center">Dollar Cost Average</h1>
  <p class="text-center text-gray-600 mb-6">
    A strategy where you invest a fixed amount regularly, but when prices are low you invest more.
  </p>
  <form phx-submit="calculate" class="space-y-4 mb-6">
    <div>
      <label for="tickers" class="block font-semibold mb-1">Tickers (comma separated):</label>
      <input
        type="text"
        name="tickers"
        value={Enum.join(@tickers, ",")}
        class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>
    <div class="grid grid-cols-3 gap-4 items-end relative">
      <div>
        <label for="dca_low" class="block font-semibold mb-1">Low Threshold:</label>
        <input
          type="number"
          step="0.01"
          max="1"
          min="0"
          name="dca_low"
          value={@dca_low}
          class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div>
        <label for="dca_high" class="block font-semibold mb-1">High Threshold:</label>
        <input
          type="number"
          step="0.01"
          max="1"
          min="0"
          name="dca_high"
          value={@dca_high}
          class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
        Calculate
      </button>
      <div class="absolute -right-36 top-1/4 transform -translate-y-1/2 hidden lg:block drop-shadow-md">
        <span class="text-red-600 font-serif font-bold text-lg block mb-1">Press HERE!</span>
        <svg
          version="1.1"
          id="ios7_x5F_arrows_1_"
          xmlns="http://www.w3.org/2000/svg"
          x="0"
          y="0"
          viewBox="0 0 128 128"
          width="64"
          height="64"
          style="enable-background:new 0 0 128 128"
          xml:space="preserve"
          fill="#C72A2A"
        >
          <g id="_x32_8_1_">
            <path
              d="M78.1 0v6.2c22.4 0 40.5 18.2 40.5 40.6s-18.1 40.6-40.5 40.6H27.9l12.4-12.4-4.5-4.5L5.5 90.8l36 36.2 4.5-4.5-16.3-16.3h52.5c25.8 0 46.7-21 46.7-46.8S103.9 0 78.1 0z"
              id="icon_13_"
            />
          </g>
        </svg>
      </div>
    </div>
  </form>
  <%= if Enum.any?(@results) do %>
    <table class="w-full table-auto border-collapse text-left text-sm">
      <thead>
        <tr class="bg-gray-300">
          <th class="px-4 py-2 border">Ticker</th>
          <th class="px-4 py-2 border">Daily High</th>
          <th class="px-4 py-2 border">High x <%= @dca_low %></th>
          <th class="px-4 py-2 border">High x <%= @dca_high %></th>
          <th class="px-4 py-2 border">Year High</th>
          <th class="px-4 py-2 border">Strategy</th>
        </tr>
      </thead>
      <tbody>
        <%= for result <- @results do %>
          <!-- placeholder span to force tailwind to generate those classes on dev -->
          <span class="bg-gray-100 bg-green-100 bg-blue-100 hover:bg-gray-200 hover:bg-green-200 hover:bg-blue-200">
          </span>
          <tr class={"hover:bg-" <> result.color <> "-200 bg-" <> result.color <> "-100"}>
            <td class="px-4 py-2 border"><%= result.ticker %></td>
            <td class="px-4 py-2 border text-right"><%= result.daily_high %></td>
            <td class={"px-4 py-2 border text-right" <> (if result.strategy == "Don't buy", do: " text-gray-300", else: "")}>
              <%= result.threshold_aggressive %>
            </td>
            <td class={"px-4 py-2 border text-right" <> (if result.strategy == "Buy aggressively", do: " text-gray-300", else: "")}>
              <%= result.threshold_normal %>
            </td>
            <td class="px-4 py-2 border text-right"><%= result.high_52_week %></td>
            <td class="px-4 py-2 border">
              <div class="relative group">
                <span class="cursor-help"><u><%= result.strategy %></u></span>
                <div class="absolute z-10 w-64 px-4 py-2 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 group-hover:opacity-100 bottom-full left-1/2 -translate-x-1/2 mb-2 pointer-events-none">
                  <%= case result.strategy do %>
                    <% "Don't buy" -> %>
                      The daily high (<%= result.daily_high %>) is above the high threshold (<%= result.threshold_normal %>). It's recommended to wait for a better entry point.
                    <% "Buy aggressively" -> %>
                      The daily high (<%= result.daily_high %>) is below the low threshold (<%= result.threshold_aggressive %>). This presents a potentially good buying opportunity.
                    <% _ -> %>
                      The daily high (<%= result.daily_high %>) is between the low (<%= result.threshold_aggressive %>) and high (<%= result.threshold_normal %>) thresholds. Consider buying at your regular pace.
                  <% end %>
                  <div class="absolute w-3 h-3 bg-white border-t border-r border-gray-200 transform rotate-45 -bottom-1.5 left-1/2 -translate-x-1/2">
                  </div>
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
<footer class="mt-12 text-center text-gray-400 text-sm">
  <p>
    Made by
    <a href="https://alexandremcosta.github.io" class="text-blue-400 hover:underline">me</a>
    with the support of
    <a href="https://openai.com/chatgpt" class="text-blue-400 hover:underline">ChatGPT</a>
    and uses public data from Yahoo Finance API
    <%= for {result, index} <- Enum.with_index(@results, 1) do %>
      <a href={result.url} class="text-blue-500 hover:underline"><%= index %></a>
    <% end %>
  </p>
</footer>
